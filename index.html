<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>KRYONIS PORTAL — Live Operations</title>
  <meta name="description" content="KRYONIS OPERATIONS CONSOLE — Real-time coherence telemetry." />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Inter:wght@300;400;500&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    :root {
      /* THEME COLORS */
      --bg: #010101;
      --bg-panel: rgba(10, 11, 14, 0.85); /* Slightly more opaque for better contrast */
      
      --fg: #e1e1e6;
      --fg-dim: #6b7280;
      --fg-muted: #9ca3af;

      /* STATUS COLORS */
      --gold: #D4AF37;
      --gold-dim: rgba(212, 175, 55, 0.15);
      --alert: #ef4444;
      --warn: #f59e0b;
      --ok: #10b981;
      --tech: #3b82f6;

      --border: rgba(255, 255, 255, 0.08);
      --border-active: rgba(212, 175, 55, 0.5);
      
      --glass: blur(12px);
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg);
      color: var(--fg);
      font-size: 14px;
      line-height: 1.5;
      overflow-x: hidden; /* Prevent horizontal scroll */
      -webkit-font-smoothing: antialiased;
    }

    /* UTILS */
    .mono { font-family: 'JetBrains Mono', monospace; letter-spacing: -0.03em; }
    .serif { font-family: 'Cinzel', serif; }
    .caps { text-transform: uppercase; letter-spacing: 0.08em; }
    
    .text-gold { color: var(--gold); }
    .text-ok { color: var(--ok); }
    .text-warn { color: var(--warn); }
    .text-alert { color: var(--alert); }
    .text-tech { color: var(--tech); }
    .text-dim { color: var(--fg-dim); }
    
    .wrapper {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 1.5rem;
      position: relative;
      z-index: 10;
    }

    /* BACKGROUND FX */
    .noise {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: 900; opacity: 0.04;
      background: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
    }
    #radar-canvas {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      z-index: -1; opacity: 0.25;
    }

    /* HEADER */
    header {
      position: fixed; top: 0; width: 100%; z-index: 100;
      background: rgba(1,1,1,0.95); backdrop-filter: blur(16px);
      border-bottom: 1px solid var(--border);
      height: 70px; display: flex; align-items: center;
    }
    .top-bar {
      display: flex; justify-content: space-between; width: 100%; align-items: center;
      gap: 1rem;
    }
    
    .sim-select {
      background: #050505; border: 1px solid var(--border); color: var(--gold);
      font-family: 'JetBrains Mono', monospace; font-size: 11px; padding: 4px 8px;
      text-transform: uppercase; cursor: pointer; outline: none; border-radius: 4px;
      transition: 0.2s;
    }
    .sim-select:hover { border-color: var(--gold); }

    .status-pill {
      font-size: 10px; border: 1px solid var(--ok); color: var(--ok);
      padding: 3px 8px; border-radius: 4px; background: rgba(16, 185, 129, 0.08);
      font-weight: 600; letter-spacing: 0.05em;
      white-space: nowrap; transition: 0.3s;
    }
    .status-pill.warn { border-color: var(--warn); color: var(--warn); background: rgba(245, 158, 11, 0.08); }
    .status-pill.crit { border-color: var(--alert); color: var(--alert); background: rgba(239, 68, 68, 0.08); }

    /* LAYOUT GRID */
    main { padding-top: 90px; padding-bottom: 40px; }
    
    .dash-grid {
      display: grid;
      grid-template-columns: 240px 1fr 340px;
      gap: 1.5rem;
      align-items: start;
    }

    /* PANELS */
    .panel {
      background: var(--bg-panel);
      border: 1px solid var(--border);
      padding: 1.2rem;
      position: relative;
      transition: border-color 0.3s;
      box-shadow: 0 4px 20px rgba(0,0,0,0.4);
    }
    
    /* HUD Corners - Refined */
    .panel::before, .panel::after {
      content: ''; position: absolute; width: 8px; height: 8px; transition: 0.3s;
      border-color: rgba(255,255,255,0.15); border-style: solid; pointer-events: none;
    }
    .panel::before { top: 0; left: 0; border-width: 1px 0 0 1px; }
    .panel::after { bottom: 0; right: 0; border-width: 0 1px 1px 0; }
    .panel:hover { border-color: rgba(255,255,255,0.2); }
    .panel:hover::before, .panel:hover::after { border-color: var(--gold); }

    .panel-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 1.2rem; border-bottom: 1px solid rgba(255,255,255,0.06);
      padding-bottom: 0.6rem;
    }
    .p-title { font-size: 0.75rem; color: var(--gold); letter-spacing: 0.1em; font-weight: 600; }

    /* SIDE NAV */
    .side-nav a {
      display: block; padding: 0.7rem 1rem;
      border-left: 2px solid transparent;
      color: var(--fg-muted); font-size: 0.8rem;
      transition: 0.2s;
      margin-bottom: 2px;
    }
    .side-nav a:hover, .side-nav a.active {
      border-left-color: var(--gold); color: var(--fg);
      background: linear-gradient(90deg, rgba(212, 175, 55, 0.08), transparent);
    }

    /* LIVE CHART */
    #gci-chart {
      width: 100%; height: 140px;
      display: block;
      margin-top: 1rem;
    }

    /* =========================================
       FIXED AUDIT LOG STYLES
       ========================================= */
    .log-feed {
      height: 240px; 
      overflow-y: hidden; /* Prevents manual scroll, keeps it clean */
      display: flex; 
      flex-direction: column; /* Normal flow */
      justify-content: flex-start; /* Items start from top */
      position: relative;
    }
    
    /* The individual log entry */
    .log-line {
      /* GRID LAYOUT for perfect alignment */
      display: grid;
      grid-template-columns: 70px 1fr; /* Fixed width for timestamp, rest for msg */
      gap: 12px;
      align-items: center;
      
      /* SPACING FIXES */
      padding: 8px 4px;
      min-height: 36px; /* Prevents crushing */
      margin-bottom: 1px;
      border-bottom: 1px solid rgba(255,255,255,0.04);
      
      /* FONT FIXES */
      font-size: 12px; /* Readable specific pixel size */
      line-height: 1.4;
      
      /* ANIMATION */
      animation: slideIn 0.3s cubic-bezier(0.23, 1, 0.32, 1);
      flex-shrink: 0; /* CRITICAL: Prevents flexbox squashing */
    }

    /* Zebra striping for better readability */
    .log-line:nth-child(odd) { background: rgba(255,255,255,0.015); }

    .log-ts { 
      color: var(--fg-dim); 
      font-family: 'JetBrains Mono'; 
      font-size: 11px;
      opacity: 0.8;
    }
    
    .log-msg {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      color: var(--fg);
    }

    /* NODES */
    .node-row {
      display: flex; justify-content: space-between; align-items: center;
      padding: 0.9rem 0.5rem; border-bottom: 1px solid rgba(255,255,255,0.04);
      transition: background 0.3s;
    }
    .node-row:hover { background: rgba(255,255,255,0.02); }
    .node-status {
      width: 8px; height: 8px; background: var(--fg-dim); border-radius: 50%;
      transition: 0.3s; box-shadow: 0 0 5px rgba(0,0,0,0.5);
    }
    .node-status.ok { background: var(--ok); box-shadow: 0 0 8px var(--ok); }
    .node-status.warn { background: var(--warn); box-shadow: 0 0 8px var(--warn); }
    .node-status.crit { background: var(--alert); box-shadow: 0 0 8px var(--alert); animation: pulseCrit 0.8s infinite; }

    /* ALERTS */
    .alert-box {
      padding: 1rem; border: 1px solid rgba(239, 68, 68, 0.3); 
      background: rgba(239, 68, 68, 0.08); margin-bottom: 1rem;
      display: none; border-left: 3px solid var(--alert);
      animation: flashAlert 0.5s;
    }
    .alert-box.active { display: block; }

    /* ANIMATIONS */
    @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    @keyframes slideIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulseCrit { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
    @keyframes flashAlert { 0% { background: rgba(239, 68, 68, 0.2); } 100% { background: rgba(239, 68, 68, 0.08); } }

    /* MOBILE */
    @media (max-width: 1024px) {
      .dash-grid { grid-template-columns: 1fr; gap: 1rem; }
      
      .side-nav { 
        display: flex; overflow-x: auto; margin-bottom: 0.5rem; gap: 0.5rem; 
        padding-bottom: 0.5rem;
        scrollbar-width: none; /* Hide scrollbar Firefox */
      }
      .side-nav::-webkit-scrollbar { display: none; /* Hide scrollbar Chrome */ }
      
      .side-nav a { 
        border: 1px solid var(--border); border-radius: 4px; 
        padding: 0.5rem 1rem; background: rgba(255,255,255,0.02);
        white-space: nowrap;
      }
      .side-nav a.active { border-color: var(--gold); background: rgba(212, 175, 55, 0.1); }
      
      header { height: auto; padding: 12px 0; }
      .top-bar { flex-wrap: wrap; }
      
      /* Mobile Clock Area Adjustment */
      .clock-area { 
        width: 100%; justify-content: space-between; 
        border-top: 1px solid rgba(255,255,255,0.08); 
        padding-top: 0.8rem; margin-top: 0.6rem; 
      }
      
      /* Log adjustments for mobile */
      .log-feed { height: 200px; }
      .log-line { font-size: 11px; padding: 8px 0; }
    }
  </style>
</head>
<body>

  <div class="noise"></div>
  <canvas id="radar-canvas"></canvas>

  <header>
    <div class="wrapper top-bar">
      <div style="display:flex; align-items:center; gap:1rem;">
        <div class="text-gold serif" style="font-size:1.4rem;">⦿</div>
        <div>
          <div class="serif caps" style="line-height:1.1; font-size:1rem;">Kryonis Portal</div>
          <div class="mono caps text-dim" style="font-size:0.65rem; letter-spacing:0.05em;">Sovereign Operations Console</div>
        </div>
      </div>
      
      <div class="clock-area mono caps" style="display:flex; gap:1rem; align-items:center;">
        <select id="sim-level" class="sim-select">
          <option value="1">MODE: LIGHT</option>
          <option value="2">MODE: STD</option>
          <option value="3" selected>MODE: ULTRA</option>
        </select>
        <div id="clock" style="min-width:70px; text-align:right; color:var(--fg);">00:00:00</div>
        <div id="sys-status" class="status-pill">SYSTEM NOMINAL</div>
      </div>
    </div>
  </header>

  <main class="wrapper">
    <div class="dash-grid">
      
      <nav class="panel side-nav mono caps">
        <div class="p-title mb-2 text-dim" style="padding:0 0.5rem 0.5rem 0.5rem; display:block;">MODULES</div>
        <a href="#" class="active">Overview</a>
        <a href="#">K-Pulse Telemetry</a>
        <a href="#">Node Lattice</a>
        <a href="#">PoC Analytics</a>
        <a href="#">Lethe Protocol</a>
        <a href="https://kryonis.global" target="_blank" style="color:var(--gold); margin-top:0.5rem; border-color:rgba(212,175,55,0.2);">Global Site ↗</a>
      </nav>

      <div style="display:flex; flex-direction:column; gap:1.5rem;">
        
        <div class="panel">
          <div class="panel-header mono caps">
            <span class="p-title">Global Coherence Index (GCI)</span>
            <span class="text-tech" id="live-indicator" style="font-size:10px; animation:blink 2s infinite;">● LIVE</span>
          </div>
          <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:1rem; text-align:center;">
            <div>
              <div id="val-gci" class="metric-big serif text-gold" style="font-size:2.2rem;">98.40</div>
              <div class="metric-label mono caps">Signal Integrity</div>
            </div>
            <div>
              <div id="val-nodes" class="metric-big serif" style="font-size:2.2rem;">7</div>
              <div class="metric-label mono caps">Active Nodes</div>
            </div>
            <div>
              <div id="val-lat" class="metric-big serif text-ok" style="font-size:2.2rem;">0.02s</div>
              <div class="metric-label mono caps">Sync Latency</div>
            </div>
          </div>
          
          <canvas id="gci-chart"></canvas>
        </div>

        <div class="panel">
           <div class="panel-header mono caps">
             <span class="p-title">Node Lattice Status</span>
           </div>
           <div class="mono" style="font-size:0.85rem;" id="node-list">
             </div>
        </div>

      </div>

      <div style="display:flex; flex-direction:column; gap:1.5rem;">
        
        <div class="panel" id="alert-panel" style="min-height:100px;">
          <div class="panel-header mono caps">
             <span class="p-title">System Alerts</span>
          </div>
          <div id="alert-container">
             <div class="text-dim" style="font-size:0.8rem; padding:0.5rem; font-style:italic;">No active alerts.</div>
          </div>
        </div>

        <div class="panel" style="flex-grow:1;">
          <div class="panel-header mono caps">
             <span class="p-title">Audit Stream</span>
             <span class="text-dim" style="font-size:0.7rem;">CH: 224-ENC</span>
          </div>
          <div class="log-feed" id="log-container">
             </div>
        </div>

      </div>

    </div>
  </main>

  <script>
    /* =========================================
       SIM-ENGINE v2.2: OPTIMIZED & STABILIZED
       ========================================= */
    
    const STATE = {
      mode: 3, 
      gci: 98.40,
      latency: 0.02,
      nodes: [
        { name: "ARCTICA-01 (Bio)", status: "ok" },
        { name: "ORBITAL (Sim)", status: "ok" },
        { name: "PACIFIC-RIM (Gov)", status: "warn" },
        { name: "URBAN-CORE (Cog)", status: "ok" },
        { name: "DEEP-RURAL (Eco)", status: "ok" }
      ],
      history: [],
      logCount: 0
    };

    // DOM
    const els = {
      gci: document.getElementById('val-gci'),
      lat: document.getElementById('val-lat'),
      nodeList: document.getElementById('node-list'),
      log: document.getElementById('log-container'),
      alerts: document.getElementById('alert-container'),
      sysStatus: document.getElementById('sys-status'),
      simSel: document.getElementById('sim-level')
    };

    // INIT
    for(let i=0; i<100; i++) STATE.history.push(98.0 + Math.random());

    els.simSel.addEventListener('change', (e) => {
      STATE.mode = parseInt(e.target.value);
      addLog("SYSTEM", `Simulation Mode switched to LEVEL ${STATE.mode}`);
    });

    // LOGIC
    function updateSimulation() {
      if (STATE.mode === 1) return;

      // GCI Logic
      const volatility = STATE.mode === 3 ? 0.12 : 0.04;
      let change = (Math.random() - 0.5) * volatility;
      STATE.gci = Math.max(85, Math.min(100, STATE.gci + change));
      
      // Latency Logic
      if (STATE.gci < 95) STATE.latency += 0.002;
      else STATE.latency = Math.max(0.01, STATE.latency - 0.002);

      STATE.history.push(STATE.gci);
      if(STATE.history.length > 150) STATE.history.shift();

      // Text Render
      els.gci.innerText = STATE.gci.toFixed(2);
      els.lat.innerText = STATE.latency.toFixed(3) + "s";
      
      // Colorize
      if(STATE.gci > 96) els.gci.className = "metric-big serif text-gold";
      else if(STATE.gci > 90) els.gci.className = "metric-big serif text-warn";
      else els.gci.className = "metric-big serif text-alert";

      // System Status
      const crit = STATE.nodes.some(n => n.status === 'crit');
      const warn = STATE.nodes.some(n => n.status === 'warn');

      if (crit) {
        els.sysStatus.innerText = "SYSTEM UNSTABLE";
        els.sysStatus.className = "status-pill crit";
      } else if (warn || STATE.gci < 94) {
        els.sysStatus.innerText = "COHERENCE DRIFT";
        els.sysStatus.className = "status-pill warn";
      } else {
        els.sysStatus.innerText = "SYSTEM NOMINAL";
        els.sysStatus.className = "status-pill";
      }
    }

    // NODES RENDER
    function renderNodes() {
      els.nodeList.innerHTML = '';
      STATE.nodes.forEach(n => {
        const row = document.createElement('div');
        row.className = 'node-row';
        
        // Visual status check
        if(STATE.mode === 3 && Math.random() > 0.98) {
           // Random flicker logic would go here
        }

        row.innerHTML = `<span>${n.name}</span><span class="node-status ${n.status}"></span>`;
        els.nodeList.appendChild(row);
      });
    }

    // LOGIC: RANDOM EVENTS (ULTRA MODE)
    setInterval(() => {
      if(STATE.mode !== 3) return;

      if(Math.random() > 0.8) {
        const node = STATE.nodes[Math.floor(Math.random() * STATE.nodes.length)];
        const actions = ['ok', 'warn', 'crit'];
        // Weighted random
        const outcome = Math.random() > 0.8 ? 'warn' : (Math.random() > 0.95 ? 'crit' : 'ok');
        
        if(node.status !== outcome) {
           node.status = outcome;
           renderNodes();
           if(outcome === 'crit') {
             triggerAlert(`${node.name} CRITICAL FAILURE`);
             addLog("CRIT", `${node.name} offline.`);
           } else if(outcome === 'warn') {
             addLog("WARN", `${node.name} destabilized.`);
           } else {
             addLog("SYS", `${node.name} stabilized.`);
           }
        }
      }
    }, 2000);

    function triggerAlert(msg) {
      els.alerts.innerHTML = `<div class="alert-box active"><strong class="text-alert mono">! ALERT</strong><div class="text-dim" style="margin-top:4px;">${msg}</div></div>`;
      setTimeout(() => {
         els.alerts.innerHTML = '<div class="text-dim" style="font-size:0.8rem; padding:0.5rem; font-style:italic;">No active alerts.</div>';
      }, 5000);
    }

    // LOGGING SYSTEM (FIXED)
    const logTags = ["TEL", "POC", "NET", "AI", "GOV", "BIO"];
    const logMsgs = [
      "Telemetry packet verified", "Coherence check valid", "Latency nominal", 
      "Predictive model updated", "Protocol consensus reached", "Biometric sync OK",
      "Indexing archives...", "Handshake maintained", "Resonance detected"
    ];

    function addLog(tag, msg) {
      const now = new Date();
      const time = now.toISOString().split('T')[1].split('.')[0]; // HH:MM:SS
      
      const div = document.createElement('div');
      div.className = 'log-line';
      
      let color = 'text-tech';
      if(tag === 'WARN') color = 'text-warn';
      if(tag === 'CRIT' || tag === 'ALERT') color = 'text-alert';
      if(tag === 'SYS') color = 'text-gold';

      // Grid layout structure
      div.innerHTML = `
        <div class="log-ts">${time}</div>
        <div class="log-msg"><span class="${color} mono" style="margin-right:6px;">${tag}</span>${msg}</div>
      `;
      
      els.log.prepend(div);
      
      // Keep only 7 items to prevent overcrowding/overlapping
      if(els.log.children.length > 7) {
        els.log.removeChild(els.log.lastChild);
      }
    }

    function logLoop() {
      const delay = STATE.mode === 3 ? Math.random() * 1500 + 800 : Math.random() * 4000 + 2000;
      setTimeout(() => {
        const tag = logTags[Math.floor(Math.random() * logTags.length)];
        const msg = logMsgs[Math.floor(Math.random() * logMsgs.length)];
        addLog(tag, msg);
        logLoop();
      }, delay);
    }

    // ANIMATION LOOP
    function loop() {
      updateSimulation();
      drawChart();
      requestAnimationFrame(loop);
    }

    // CHART RENDER
    const canvas = document.getElementById('gci-chart');
    const ctx = canvas.getContext('2d');
    
    function resizeChart() {
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;
    }
    window.addEventListener('resize', resizeChart);
    resizeChart();

    function drawChart() {
      const w = canvas.width;
      const h = canvas.height;
      ctx.clearRect(0, 0, w, h);
      
      // Guidelines
      ctx.strokeStyle = 'rgba(255,255,255,0.05)';
      ctx.beginPath(); ctx.moveTo(0, h*0.3); ctx.lineTo(w, h*0.3); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(0, h*0.7); ctx.lineTo(w, h*0.7); ctx.stroke();

      // Path
      ctx.beginPath();
      const step = w / (STATE.history.length - 1);
      STATE.history.forEach((val, i) => {
        const y = h - ((val - 88) / 12) * h; // Scale 88-100 to canvas
        if(i===0) ctx.moveTo(0, y);
        else ctx.lineTo(i * step, y);
      });
      
      ctx.strokeStyle = STATE.gci > 95 ? '#D4AF37' : (STATE.gci > 90 ? '#f59e0b' : '#ef4444');
      ctx.lineWidth = 2;
      ctx.stroke();
      
      // Gradient Fill
      ctx.lineTo(w, h); ctx.lineTo(0, h);
      const grad = ctx.createLinearGradient(0, 0, 0, h);
      grad.addColorStop(0, STATE.gci > 95 ? 'rgba(212, 175, 55, 0.2)' : 'rgba(245, 158, 11, 0.2)');
      grad.addColorStop(1, 'rgba(0,0,0,0)');
      ctx.fillStyle = grad;
      ctx.fill();
    }

    // RADAR BG
    const rCanvas = document.getElementById('radar-canvas');
    const rCtx = rCanvas.getContext('2d');
    let rW, rH, scanY = 0;
    function rResize() { rW = rCanvas.width = window.innerWidth; rH = rCanvas.height = window.innerHeight; }
    window.addEventListener('resize', rResize); rResize();

    function animRadar() {
      rCtx.clearRect(0, 0, rW, rH);
      if(STATE.mode > 1) {
        scanY += 1.5; if(scanY > rH) scanY = 0;
        rCtx.beginPath(); rCtx.moveTo(0, scanY); rCtx.lineTo(rW, scanY);
        rCtx.strokeStyle = "rgba(212, 175, 55, 0.15)"; rCtx.lineWidth=1; rCtx.stroke();
      }
      requestAnimationFrame(animRadar);
    }

    // CLOCK
    setInterval(() => {
      const now = new Date();
      document.getElementById('clock').innerText = now.toISOString().split('T')[1].split('.')[0];
    }, 1000);

    // START
    renderNodes();
    logLoop();
    loop();
    animRadar();

  </script>
</body>
</html>
