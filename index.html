<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KRYONIS PORTAL — Live Operations</title>
  <meta name="description" content="KRYONIS OPERATIONS CONSOLE — Real-time coherence telemetry and node management." />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Inter:wght@300;400;500&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    :root {
      /* THEME */
      --bg: #010101;
      --bg-panel: rgba(8, 8, 10, 0.75);
      --fg: #e1e1e6;
      --fg-dim: #5c616b;
      --fg-muted: #888;

      /* SIGNALS */
      --gold: #D4AF37;
      --gold-dim: rgba(212, 175, 55, 0.2);
      --alert: #ff3333;
      --warn: #ffaa00;
      --ok: #33ff88;
      --tech: #6e8cff;

      --border: rgba(255, 255, 255, 0.08);
      --border-active: rgba(212, 175, 55, 0.4);
      --glass: blur(8px);
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg);
      color: var(--fg);
      font-size: 14px;
      line-height: 1.5;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
    }

    /* UTILS */
    .mono { font-family: 'JetBrains Mono', monospace; letter-spacing: -0.02em; }
    .serif { font-family: 'Cinzel', serif; }
    .caps { text-transform: uppercase; letter-spacing: 0.1em; }
    .text-gold { color: var(--gold); }
    .text-ok { color: var(--ok); }
    .text-warn { color: var(--warn); }
    .text-alert { color: var(--alert); }
    .text-tech { color: var(--tech); }
    .text-dim { color: var(--fg-dim); }
    
    .wrapper {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 1.5rem;
      position: relative;
      z-index: 10;
    }

    /* BG FX */
    .noise {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: 900; opacity: 0.06;
      background: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
    }
    #radar-canvas {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      z-index: -1; opacity: 0.3;
    }

    /* HEADER */
    header {
      position: fixed; top: 0; width: 100%; z-index: 100;
      background: rgba(1,1,1,0.9); backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      height: 70px; display: flex; align-items: center;
    }
    .top-bar {
      display: flex; justify-content: space-between; width: 100%; align-items: center;
      gap: 1rem;
    }
    
    /* SIM CONTROLS */
    .sim-select {
      background: #000; border: 1px solid var(--fg-dim); color: var(--gold);
      font-family: 'JetBrains Mono', monospace; font-size: 10px; padding: 2px 6px;
      text-transform: uppercase; cursor: pointer; outline: none;
    }
    .sim-select:hover { border-color: var(--gold); }

    .status-pill {
      font-size: 10px; border: 1px solid var(--ok); color: var(--ok);
      padding: 2px 6px; border-radius: 2px; background: rgba(51, 255, 136, 0.1);
      white-space: nowrap; transition: 0.3s;
    }
    .status-pill.warn { border-color: var(--warn); color: var(--warn); background: rgba(255, 170, 0, 0.1); }
    .status-pill.crit { border-color: var(--alert); color: var(--alert); background: rgba(255, 50, 50, 0.1); }

    /* GRID */
    main { padding-top: 90px; padding-bottom: 40px; }
    
    .dash-grid {
      display: grid;
      grid-template-columns: 220px 1fr 320px;
      gap: 1.5rem;
      align-items: start;
    }

    /* PANELS */
    .panel {
      background: var(--bg-panel);
      border: 1px solid var(--border);
      padding: 1.2rem;
      backdrop-filter: var(--glass);
      position: relative;
      transition: border-color 0.3s;
    }
    /* HUD Corners */
    .panel::before, .panel::after {
      content: ''; position: absolute; width: 6px; height: 6px; transition: 0.3s;
      border-color: var(--fg-dim); border-style: solid;
    }
    .panel::before { top: -1px; left: -1px; border-width: 1px 0 0 1px; }
    .panel::after { bottom: -1px; right: -1px; border-width: 0 1px 1px 0; }
    .panel:hover { border-color: var(--border-active); }
    .panel:hover::before, .panel:hover::after { border-color: var(--gold); }

    .panel-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.05);
      padding-bottom: 0.5rem;
    }
    .p-title { font-size: 0.7rem; color: var(--gold); }

    /* SIDE NAV */
    .side-nav a {
      display: block; padding: 0.6rem 1rem;
      border-left: 2px solid transparent;
      color: var(--fg-muted); font-size: 0.8rem;
      transition: 0.2s;
    }
    .side-nav a:hover, .side-nav a.active {
      border-left-color: var(--gold); color: var(--fg);
      background: linear-gradient(90deg, rgba(212, 175, 55, 0.05), transparent);
    }

    /* LIVE CHART */
    #gci-chart {
      width: 100%; height: 120px;
      border-bottom: 1px solid var(--border);
      display: block;
    }

    /* LOGS */
    .log-feed {
      height: 220px; overflow-y: hidden;
      font-size: 0.75rem; display: flex; flex-direction: column-reverse;
    }
    .log-line {
      padding: 4px 0; border-bottom: 1px solid rgba(255,255,255,0.02);
      animation: slideIn 0.2s ease-out;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .log-ts { color: var(--fg-dim); margin-right: 8px; font-family: 'JetBrains Mono'; }
    .log-tag { display: inline-block; width: 60px; }

    /* NODES */
    .node-row {
      display: flex; justify-content: space-between; align-items: center;
      padding: 0.8rem 0; border-bottom: 1px solid rgba(255,255,255,0.03);
      transition: background 0.3s;
    }
    .node-status {
      width: 8px; height: 8px; background: var(--fg-dim); border-radius: 50%;
      transition: 0.3s;
    }
    .node-status.ok { background: var(--ok); box-shadow: 0 0 8px var(--ok); }
    .node-status.warn { background: var(--warn); box-shadow: 0 0 8px var(--warn); }
    .node-status.crit { background: var(--alert); box-shadow: 0 0 8px var(--alert); animation: pulseCrit 1s infinite; }

    /* ALERTS */
    .alert-box {
      padding: 0.8rem; border: 1px solid rgba(255,50,50,0.3); 
      background: rgba(255,50,50,0.05); margin-bottom: 0.5rem;
      display: none; /* Hidden by default */
      animation: flashAlert 0.5s;
    }
    .alert-box.active { display: block; }

    /* ANIMATIONS */
    @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
    @keyframes slideIn { from { opacity: 0; transform: translateX(-5px); } to { opacity: 1; transform: translateX(0); } }
    @keyframes pulseCrit { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
    @keyframes flashAlert { 0% { background: rgba(255,50,50,0.4); } 100% { background: rgba(255,50,50,0.05); } }

    /* MOBILE */
    @media (max-width: 1024px) {
      .dash-grid { grid-template-columns: 1fr; }
      .side-nav { display: flex; overflow-x: auto; margin-bottom: 1rem; gap: 1rem; }
      .side-nav a { border-left: none; border-bottom: 2px solid transparent; }
      .side-nav a:hover { border-left: none; border-bottom-color: var(--gold); }
      header { height: auto; padding: 10px 0; }
      .top-bar { flex-wrap: wrap; }
      .clock-area { width: 100%; justify-content: space-between; border-top: 1px solid rgba(255,255,255,0.05); padding-top: 0.5rem; margin-top: 0.5rem; }
    }
  </style>
</head>
<body>

  <div class="noise"></div>
  <canvas id="radar-canvas"></canvas>

  <header>
    <div class="wrapper top-bar">
      <div style="display:flex; align-items:center; gap:1rem;">
        <div class="text-gold serif" style="font-size:1.2rem;">⦿</div>
        <div>
          <div class="serif caps" style="line-height:1;">Kryonis Portal</div>
          <div class="mono caps text-dim" style="font-size:0.65rem;">Sovereign Operations</div>
        </div>
      </div>
      
      <div class="clock-area mono caps" style="display:flex; gap:1rem; align-items:center;">
        <select id="sim-level" class="sim-select">
          <option value="1">MODE: LIGHT</option>
          <option value="2">MODE: STD</option>
          <option value="3" selected>MODE: ULTRA</option>
        </select>
        <div id="clock" style="min-width:80px; text-align:right;">00:00:00</div>
        <div id="sys-status" class="status-pill">SYSTEM NOMINAL</div>
      </div>
    </div>
  </header>

  <main class="wrapper">
    <div class="dash-grid">
      
      <nav class="panel side-nav mono caps">
        <div class="p-title mb-2 text-dim" style="padding:0 1rem;">MODULES</div>
        <a href="#" class="active">Overview</a>
        <a href="#">K-Pulse Telemetry</a>
        <a href="#">Node Lattice</a>
        <a href="#">PoC Analytics</a>
        <a href="#">Lethe Protocol</a>
        <a href="https://kryonis.global" target="_blank" style="color:var(--gold); margin-top:1rem;">Global Site ↗</a>
      </nav>

      <div style="display:flex; flex-direction:column; gap:1.5rem;">
        
        <div class="panel">
          <div class="panel-header mono caps">
            <span class="p-title">Global Coherence Index (GCI)</span>
            <span class="text-tech" id="live-indicator">LIVE</span>
          </div>
          <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:1rem; text-align:center;">
            <div>
              <div id="val-gci" class="metric-big serif text-gold">98.40</div>
              <div class="metric-label mono caps">Signal Integrity</div>
            </div>
            <div>
              <div id="val-nodes" class="metric-big serif">7</div>
              <div class="metric-label mono caps">Active Nodes</div>
            </div>
            <div>
              <div id="val-lat" class="metric-big serif text-ok">0.02s</div>
              <div class="metric-label mono caps">Sync Latency</div>
            </div>
          </div>
          
          <div style="margin-top:1.5rem; position:relative;">
            <canvas id="gci-chart"></canvas>
          </div>
        </div>

        <div class="panel">
           <div class="panel-header mono caps">
             <span class="p-title">Node Lattice Status</span>
           </div>
           <div class="mono" style="font-size:0.85rem;" id="node-list">
             </div>
        </div>

      </div>

      <div style="display:flex; flex-direction:column; gap:1.5rem;">
        
        <div class="panel" id="alert-panel" style="min-height:100px;">
          <div class="panel-header mono caps">
             <span class="p-title">System Alerts</span>
          </div>
          <div id="alert-container">
             <div class="text-dim" style="font-size:0.8rem; padding:0.5rem;">No active alerts.</div>
          </div>
        </div>

        <div class="panel" style="flex-grow:1;">
          <div class="panel-header mono caps">
             <span class="p-title">Audit Stream</span>
             <span class="text-dim" style="font-size:0.7rem;">CH: 224-ENC</span>
          </div>
          <div class="log-feed mono" id="log-container"></div>
        </div>

      </div>

    </div>
  </main>

  <script>
    /* =========================================
       SIM-ENGINE v1.0: THE BRAIN
       ========================================= */
    
    const STATE = {
      mode: 3, // 1=Light, 2=Std, 3=Ultra
      gci: 98.40,
      latency: 0.02,
      nodes: [
        { name: "ARCTICA-01 (Bio)", status: "ok", val: 99 },
        { name: "ORBITAL (Sim)", status: "ok", val: 97 },
        { name: "PACIFIC-RIM (Gov)", status: "warn", val: 89 },
        { name: "URBAN-CORE (Cog)", status: "ok", val: 95 },
        { name: "DEEP-RURAL (Eco)", status: "ok", val: 98 }
      ],
      history: [], // For Chart
      alerts: []
    };

    // --- DOM ELEMENTS ---
    const els = {
      gci: document.getElementById('val-gci'),
      lat: document.getElementById('val-lat'),
      nodeList: document.getElementById('node-list'),
      log: document.getElementById('log-container'),
      alerts: document.getElementById('alert-container'),
      sysStatus: document.getElementById('sys-status'),
      simSel: document.getElementById('sim-level')
    };

    // --- INITIALIZERS ---
    // Fill chart history with baseline
    for(let i=0; i<50; i++) STATE.history.push(98.0 + Math.random());

    // Listen for Mode Change
    els.simSel.addEventListener('change', (e) => {
      STATE.mode = parseInt(e.target.value);
      addLog("SYSTEM", `Simulation Mode switched to LEVEL ${STATE.mode}`);
      renderNodes(); // reset visuals
    });

    // --- LOGIC: UPDATE STATE ---
    function updateSimulation() {
      if (STATE.mode === 1) return; // Light mode is static

      // 1. Drift GCI
      const volatility = STATE.mode === 3 ? 0.15 : 0.05;
      let change = (Math.random() - 0.5) * volatility;
      STATE.gci = Math.max(85, Math.min(100, STATE.gci + change));
      
      // 2. Correlate Latency (Lower GCI = Higher Latency)
      if (STATE.gci < 95) STATE.latency += 0.001;
      else STATE.latency = Math.max(0.01, STATE.latency - 0.001);

      // 3. Chart History
      STATE.history.push(STATE.gci);
      if(STATE.history.length > 100) STATE.history.shift();

      // 4. Node Chaos (Ultra Only)
      if (STATE.mode === 3 && Math.random() > 0.92) {
        const node = STATE.nodes[Math.floor(Math.random() * STATE.nodes.length)];
        
        // Randomly degrade or fix
        if (node.status === 'ok' && Math.random() > 0.7) {
          node.status = 'warn';
          addLog("WARN", `${node.name} decoherence detected.`);
        } else if (node.status === 'warn') {
          if (Math.random() > 0.5) {
            node.status = 'ok';
            addLog("SYS", `${node.name} restabilized.`);
          } else if (Math.random() > 0.8) {
            node.status = 'crit';
            addLog("CRIT", `${node.name} CRITICAL FAILURE.`);
            triggerAlert(`${node.name} OFFLINE`);
          }
        } else if (node.status === 'crit') {
           node.status = 'warn'; // Recovery
           addLog("SYS", `${node.name} rebooting sequence...`);
        }
        renderNodes();
      }

      // 5. System Status Logic
      updateSystemStatus();

      // 6. Render Text
      els.gci.innerText = STATE.gci.toFixed(2);
      els.lat.innerText = STATE.latency.toFixed(3) + "s";
      
      // Colorize GCI
      els.gci.className = `metric-big serif ${STATE.gci > 95 ? 'text-gold' : (STATE.gci > 90 ? 'text-warn' : 'text-alert')}`;
    }

    function updateSystemStatus() {
      const critCount = STATE.nodes.filter(n => n.status === 'crit').length;
      const warnCount = STATE.nodes.filter(n => n.status === 'warn').length;

      if (critCount > 0) {
        els.sysStatus.innerText = "SYSTEM UNSTABLE";
        els.sysStatus.className = "status-pill crit";
      } else if (warnCount > 0 || STATE.gci < 94) {
        els.sysStatus.innerText = "COHERENCE DRIFT";
        els.sysStatus.className = "status-pill warn";
      } else {
        els.sysStatus.innerText = "SYSTEM NOMINAL";
        els.sysStatus.className = "status-pill";
      }
    }

    function triggerAlert(msg) {
      const div = document.createElement('div');
      div.className = 'alert-box active';
      div.innerHTML = `<strong class="text-alert">! ANOMALY</strong><br><span class="text-dim">${msg}</span>`;
      els.alerts.innerHTML = ''; // Clear old (simple mode)
      els.alerts.appendChild(div);
      
      // Auto clear after 4s
      setTimeout(() => {
        if(els.alerts.contains(div)) div.remove();
        if(els.alerts.children.length === 0) els.alerts.innerHTML = '<div class="text-dim" style="font-size:0.8rem; padding:0.5rem;">No active alerts.</div>';
      }, 4000);
    }

    // --- RENDERERS ---

    function renderNodes() {
      els.nodeList.innerHTML = '';
      STATE.nodes.forEach(n => {
        const row = document.createElement('div');
        row.className = 'node-row';
        
        let dotClass = 'ok';
        if(n.status === 'warn') dotClass = 'warn';
        if(n.status === 'crit') dotClass = 'crit';

        row.innerHTML = `<span>${n.name}</span><span class="node-status ${dotClass}"></span>`;
        els.nodeList.appendChild(row);
      });
    }

    // Charting with Canvas
    const chartCanvas = document.getElementById('gci-chart');
    const chartCtx = chartCanvas.getContext('2d');
    
    function resizeChart() {
      chartCanvas.width = chartCanvas.offsetWidth;
      chartCanvas.height = chartCanvas.offsetHeight;
    }
    window.addEventListener('resize', resizeChart);
    resizeChart();

    function drawChart() {
      const w = chartCanvas.width;
      const h = chartCanvas.height;
      chartCtx.clearRect(0, 0, w, h);

      // Grid lines
      chartCtx.strokeStyle = 'rgba(255,255,255,0.05)';
      chartCtx.beginPath();
      chartCtx.moveTo(0, h/2); chartCtx.lineTo(w, h/2);
      chartCtx.stroke();

      // Data Line
      chartCtx.beginPath();
      const step = w / (STATE.history.length - 1);
      
      STATE.history.forEach((val, i) => {
        // Map 90-100 to height
        const y = h - ((val - 90) / 10) * h; 
        if(i===0) chartCtx.moveTo(0, y);
        else chartCtx.lineTo(i * step, y);
      });

      chartCtx.strokeStyle = '#D4AF37';
      chartCtx.lineWidth = 2;
      chartCtx.stroke();
      
      // Fill
      chartCtx.lineTo(w, h);
      chartCtx.lineTo(0, h);
      const grad = chartCtx.createLinearGradient(0, 0, 0, h);
      grad.addColorStop(0, 'rgba(212, 175, 55, 0.2)');
      grad.addColorStop(1, 'rgba(212, 175, 55, 0)');
      chartCtx.fillStyle = grad;
      chartCtx.fill();
    }

    // --- LOG GENERATOR ---
    const logTemplates = [
      { tag: "TEL", msg: "Telemetry packet verified." },
      { tag: "POC", msg: "Coherence check: VALID." },
      { tag: "NET", msg: "Latency nominal." },
      { tag: "AI",  msg: "Predictive model updated." },
      { tag: "GOV", msg: "Protocol consensus reached." }
    ];

    function logLoop() {
      // Frequency depends on mode
      const delay = STATE.mode === 3 ? Math.random() * 1500 + 500 : Math.random() * 4000 + 2000;
      
      setTimeout(() => {
        // If Ultra mode, chance for "intelligent" logs
        if (STATE.mode === 3 && Math.random() > 0.7) {
           // Log derived from state
           addLog("GCI", `Index fluctuation: ${STATE.gci.toFixed(2)}`);
        } else {
           // Generic log
           const t = logTemplates[Math.floor(Math.random() * logTemplates.length)];
           addLog(t.tag, t.msg);
        }
        logLoop();
      }, delay);
    }

    function addLog(tag, msg) {
      const time = new Date().toISOString().split('T')[1].split('.')[0];
      const div = document.createElement('div');
      div.className = 'log-line';
      
      let colorClass = 'text-tech';
      if (tag === 'WARN') colorClass = 'text-warn';
      if (tag === 'CRIT') colorClass = 'text-alert';

      div.innerHTML = `<span class="log-ts">[${time}]</span><span class="log-tag ${colorClass}">${tag}</span> ${msg}`;
      els.log.prepend(div);
      if(els.log.children.length > 15) els.log.removeChild(els.log.lastChild);
    }


    // --- MAIN LOOPS ---
    renderNodes(); // Initial
    logLoop();     // Start Logger

    // High Speed Loop (Animation)
    function loop() {
      updateSimulation();
      drawChart();
      requestAnimationFrame(loop);
    }
    loop();

    // Clock
    setInterval(() => {
      document.getElementById('clock').innerText = new Date().toISOString().split('T')[1].split('.')[0] + " UTC";
    }, 1000);


    // --- RADAR BACKGROUND (Visual Only) ---
    const rCanvas = document.getElementById('radar-canvas');
    const rCtx = rCanvas.getContext('2d');
    let rW, rH, scanY = 0;
    function rResize() { rW = rCanvas.width = window.innerWidth; rH = rCanvas.height = window.innerHeight; }
    window.addEventListener('resize', rResize); rResize();

    function animRadar() {
      rCtx.clearRect(0, 0, rW, rH);
      if(STATE.mode > 1) { // Only animate in STD/ULTRA
        scanY += 2; 
        if(scanY > rH) scanY = 0;
        rCtx.beginPath(); rCtx.moveTo(0, scanY); rCtx.lineTo(rW, scanY);
        rCtx.strokeStyle = "rgba(212, 175, 55, 0.1)"; rCtx.stroke();
      }
      requestAnimationFrame(animRadar);
    }
    animRadar();

  </script>
</body>
</html>
